# 🚀 常用场景速查手册 (Case-by-Case Guide)

本章收集了开发者和运维人员在实际工作中最高频遇到的“复杂任务”，并给出最简洁的组合命令。

## 1. 文件处理场景

### 批量修改文件后缀名
- **场景**：把目录下所有的 `.txt` 改成 `.md`。
- **方案**：`rename 's/\.txt$/\.md/' *.txt` (需安装 rename)
- **原生方案**：`for f in *.txt; do mv "$f" "${f%.txt}.md"; done`

### 统计代码行数 (排除干扰)
- **场景**：统计当前项目有多少行代码，排除 `node_modules` 或 `.git`。
- **方案**：`find . -name "*.js" -not -path "*/node_modules/*" | xargs wc -l`
- **现代化方案**：`tokei` (需安装) 或 `cloc .`

### 快速清空文件内容
- **场景**：日志太大了，想清空它但不删除文件。
- **方案**：`> access.log` (利用重定向空内容)

---

## 2. 磁盘与清理场景

### 磁盘空间不足排查
- **快速定位大文件**：`du -ah . | sort -rh | head -n 10`
- **交互式分析**：使用 **`ncdu`**，可以像在文件管理器里一样通过光标上下移动并删除大目录/文件。
- **清理 Docker 占用**：`docker system prune -a` (清理所有未使用的容器、网络、镜像)。

### 清理超过 30 天的旧日志
- **方案**：`find /var/log -name "*.log" -mtime +30 -exec rm -f {} \;`

### 实时查看正在写入的文件
- **场景**：想知道系统现在到底在往哪个文件狂写数据？
- **方案**：`sudo iotop` (按进程看) 或 `sudo opensnoop` (按文件看)

---

## 3. 网络实战场景

### 查看内网所有存活设备的 IP
- **方案**：`fping -asg 192.168.1.0/24`

### 本地测试远程端口是否开启 (不使用 telnet)
- **方案**：`nc -zv 1.2.3.4 80`

### 快速查看自己的公网 IP
- **方案**：`curl ifconfig.me` 或 `curl ip.sb`

---

## 4. 开发者进阶组合

### 查找并替换全局代码
- **场景**：把所有文件里的 `http://old-api.com` 换成 `https://new-api.com`。
- **方案**：`grep -rl "old-api" . | xargs sed -i 's/old-api/new-api/g'`
- **现代化方案**：`sed -i 's/old/new/g' $(rg -l "old")`

### 监控一个命令直到它成功
- **场景**：等待一个服务器上线或一个部署任务完成。
- **方案**：`until ping -c 1 1.2.3.4; do sleep 5; done && echo "Server is UP!"`
