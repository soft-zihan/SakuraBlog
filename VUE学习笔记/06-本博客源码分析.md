# 06. æœ¬åšå®¢æºç åˆ†æ (Architecture) ğŸŒ¸

Sakura Notes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç”¨æ¥å†™ç¬”è®°çš„åœ°æ–¹ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªåŸºäº Vue 3 çš„**å•é¡µåº”ç”¨ (SPA)** å®æˆ˜æ¡ˆä¾‹ã€‚

æœ¬æ–‡å°†æ·±å…¥è§£ææœ¬åšå®¢çš„æ ¸å¿ƒæŠ€æœ¯å®ç°ã€‚

## 1. æ ¸å¿ƒæ¶æ„ï¼šMetadata + Runtime Fetch

ä¸åŒäº Hexo æˆ– VitePress åœ¨æ„å»ºæ—¶ç”Ÿæˆæ‰€æœ‰ HTMLï¼ŒSakura Notes é‡‡ç”¨äº†**è¿è¡Œæ—¶è·å–**çš„ç­–ç•¥ã€‚

### 1.1 æ„å»ºæ—¶ (Build Time)
æˆ‘ä»¬æœ‰ä¸€ä¸ª Node.js è„šæœ¬ `scripts/generate-tree.js`ã€‚æ¯æ¬¡éƒ¨ç½²æ—¶ï¼Œå®ƒä¼šæ‰«æ `notes/` æ–‡ä»¶å¤¹ï¼š

```javascript
// generate-tree.js (ç®€åŒ–ç‰ˆ)
const items = fs.readdirSync(dirPath);
for (const item of items) {
  if (isDir) {
    // é€’å½’æ‰«æ...
  } else if (isMarkdown) {
    result.push({
        name: item,
        path: relativePath, // notes/vue/01.md
        type: 'file'
    });
  }
}
fs.writeFileSync('files.json', JSON.stringify(result));
```

å®ƒç”Ÿæˆä¸€ä¸ª `files.json`ï¼Œè¿™æ˜¯æ•´ä¸ªåšå®¢çš„**åœ°å›¾**ã€‚

### 1.2 è¿è¡Œæ—¶ (Runtime)
å½“ç”¨æˆ·è®¿é—®åšå®¢æ—¶ï¼š
1. `App.vue` åˆå§‹åŒ–ï¼Œé¦–å…ˆ `fetch('/files.json')`ã€‚
2. æ‹¿åˆ°æ–‡ä»¶æ ‘æ•°æ®ï¼Œæ¸²æŸ“å·¦ä¾§ä¾§è¾¹æ ã€‚
3. å½“ç”¨æˆ·ç‚¹å‡»æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå†æ¬¡ `fetch('/notes/vue/01.md')` è·å–å…·ä½“å†…å®¹ã€‚

**ä¼˜ç‚¹**ï¼šé¦–å±æå¿«ï¼Œå› ä¸ºä¸éœ€è¦ä¸‹è½½æ‰€æœ‰æ–‡ç« å†…å®¹ã€‚
**ç¼ºç‚¹**ï¼šSEO è¾ƒå·®ï¼ˆå› ä¸ºæ˜¯çº¯ SPAï¼‰ï¼Œä½†ä½œä¸ºä¸ªäººçŸ¥è¯†åº“è¶³å¤Ÿäº†ã€‚

## 2. é€’å½’ç»„ä»¶ï¼šFileTree.vue

å·¦ä¾§çš„æ–‡ä»¶æ ‘æ˜¯æ— é™å±‚çº§çš„ï¼Œè¿™éœ€è¦ç”¨åˆ° Vue çš„**é€’å½’ç»„ä»¶**ã€‚

```vue
<!-- FileTree.vue -->
<template>
  <ul>
    <li v-for="node in nodes">
      <!-- å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œè‡ªå·±è°ƒç”¨è‡ªå·± -->
      <FileTree 
         v-if="node.children" 
         :nodes="node.children" 
      />
      <!-- å¦‚æœæ˜¯æ–‡ä»¶ -->
      <div v-else>{{ node.name }}</div>
    </li>
  </ul>
</template>
```

**å…³é”®ç‚¹**ï¼šç»„ä»¶å†…éƒ¨å¿…é¡»æœ‰ç»“æŸé€’å½’çš„æ¡ä»¶ï¼ˆå³ `v-else` æ¸²æŸ“æ–‡ä»¶èŠ‚ç‚¹ï¼‰ï¼Œå¦åˆ™ä¼šæ­»å¾ªç¯å¯¼è‡´æ ˆæº¢å‡ºã€‚

## 3. Markdown æ¸²æŸ“ä¸æ ·å¼éš”ç¦»

æˆ‘ä»¬ä½¿ç”¨äº† `marked.js` å°† Markdown è½¬æ¢ä¸º HTMLã€‚ä½†æ˜¯ï¼ŒåŸç”Ÿçš„ HTML æ ·å¼å¾ˆéš¾çœ‹ã€‚

### Tailwind Typography
æˆ‘ä»¬åœ¨ `index.html` å¼•å…¥äº† `tailwind-typography` æ’ä»¶ï¼Œå¹¶åœ¨å®¹å™¨ä¸Šæ·»åŠ  `markdown-body` ç±»ï¼š

```html
<div v-html="content" class="markdown-body"></div>
```

é…åˆ CSSï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†æ¯ä¸€çº§æ ‡é¢˜çš„æ ·å¼ï¼š

```css
.markdown-body h1 {
  border-bottom: 2px solid #ffe4e9; /* æ¨±èŠ±ç²‰ä¸‹åˆ’çº¿ */
}
```

## 4. è·¯ç”±ä¸çŠ¶æ€ç®¡ç†

æœ¬é¡¹ç›®æ²¡æœ‰ä½¿ç”¨ `vue-router`ï¼Œè€Œæ˜¯æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„è·¯ç”±çŠ¶æ€ç®¡ç†ã€‚

```javascript
// App.vue
const currentFile = ref(null);

// ç›‘å¬æµè§ˆå™¨åé€€/å‰è¿›
window.onpopstate = () => {
   // è§£æ URL query å‚æ•° ?path=...
   const path = new URLSearchParams(location.search).get('path');
   loadFile(path);
}

// æ›´æ–° URL ä½†ä¸åˆ·æ–°é¡µé¢
const updateUrl = (path) => {
   window.history.pushState({}, '', `?path=${path}`);
}
```

è¿™ç§â€œè½»é‡çº§è·¯ç”±â€éå¸¸é€‚åˆè¿™ç§æ–‡ä»¶é©±åŠ¨å‹çš„ç®€å•åº”ç”¨ã€‚

## 5. å®éªŒå®¤ (Lab) å®ç°

Lab æ ‡ç­¾é¡µå±•ç¤ºäº†ä¸€äº› Vue çš„æ ¸å¿ƒæ¦‚å¿µå¯è§†åŒ–ã€‚è¿™äº›å…¶å®å°±æ˜¯æ™®é€šçš„ Vue ç»„ä»¶ã€‚

æ¯”å¦‚ `LabReactivity.vue`ï¼Œå®ƒé€šè¿‡ `watch` ç›‘å¬æ•°æ®å˜åŒ–ï¼Œå¹¶æ‰‹åŠ¨è§¦å‘ DOM å…ƒç´ çš„åŠ¨ç”»ç±»åï¼Œä»è€Œå®ç°äº†â€œæ•°æ®å˜äº† -> è§†å›¾é—ªçƒâ€çš„å¯è§†åŒ–æ•ˆæœã€‚

```javascript
watch(name, () => {
  isUpdating.value = true; // è§¦å‘ CSS åŠ¨ç”»
  setTimeout(() => isUpdating.value = false, 500);
});
```

---

è¿™å°±æ˜¯ Sakura Notes çš„å¹•ååŸç†ï¼ğŸŒ¸